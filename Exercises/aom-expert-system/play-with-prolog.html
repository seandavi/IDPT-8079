<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sean Davis, MD, PhD">
<meta name="dcterms.date" content="2024-10-02">

<title>Play with Prolog – IDPT-8079: Frontier of AI in Medicine</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-93043521-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<meta name="mermaid-theme" content="forest">
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IDPT-8079: Frontier of AI in Medicine</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">Learning Goals:</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#components-of-an-expert-system" id="toc-components-of-an-expert-system" class="nav-link" data-scroll-target="#components-of-an-expert-system">Components of an Expert System</a></li>
  <li><a href="#applications-of-expert-systems" id="toc-applications-of-expert-systems" class="nav-link" data-scroll-target="#applications-of-expert-systems">Applications of Expert Systems</a></li>
  <li><a href="#limitations-of-expert-systems" id="toc-limitations-of-expert-systems" class="nav-link" data-scroll-target="#limitations-of-expert-systems">Limitations of Expert Systems</a></li>
  <li><a href="#using-chatgpt-or-claude-to-understand-expert-systems" id="toc-using-chatgpt-or-claude-to-understand-expert-systems" class="nav-link" data-scroll-target="#using-chatgpt-or-claude-to-understand-expert-systems">Using ChatGPT (or Claude) to understand Expert Systems</a></li>
  </ul></li>
  <li><a href="#the-prolog-programming-language" id="toc-the-prolog-programming-language" class="nav-link" data-scroll-target="#the-prolog-programming-language">The Prolog Programming Language</a>
  <ul class="collapse">
  <li><a href="#key-features-of-prolog" id="toc-key-features-of-prolog" class="nav-link" data-scroll-target="#key-features-of-prolog">Key features of Prolog</a></li>
  <li><a href="#role-in-ai" id="toc-role-in-ai" class="nav-link" data-scroll-target="#role-in-ai">Role in AI</a></li>
  <li><a href="#historical-significance" id="toc-historical-significance" class="nav-link" data-scroll-target="#historical-significance">Historical Significance</a></li>
  <li><a href="#current-usage" id="toc-current-usage" class="nav-link" data-scroll-target="#current-usage">Current Usage</a></li>
  <li><a href="#an-example-prolog-program" id="toc-an-example-prolog-program" class="nav-link" data-scroll-target="#an-example-prolog-program">An example Prolog program</a>
  <ul class="collapse">
  <li><a href="#explanation" id="toc-explanation" class="nav-link" data-scroll-target="#explanation">Explanation:</a></li>
  <li><a href="#how-it-works" id="toc-how-it-works" class="nav-link" data-scroll-target="#how-it-works">How It Works:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#the-task" id="toc-the-task" class="nav-link" data-scroll-target="#the-task">The task</a>
  <ul class="collapse">
  <li><a href="#knowledge-base" id="toc-knowledge-base" class="nav-link" data-scroll-target="#knowledge-base">Knowledge Base</a></li>
  <li><a href="#visualizing-the-expert-system" id="toc-visualizing-the-expert-system" class="nav-link" data-scroll-target="#visualizing-the-expert-system">Visualizing the Expert System</a></li>
  <li><a href="#reasoning-engine" id="toc-reasoning-engine" class="nav-link" data-scroll-target="#reasoning-engine">Reasoning engine</a></li>
  </ul></li>
  <li><a href="#make-it-real" id="toc-make-it-real" class="nav-link" data-scroll-target="#make-it-real">Make it REAL</a></li>
  <li><a href="#conclusion-and-reflection" id="toc-conclusion-and-reflection" class="nav-link" data-scroll-target="#conclusion-and-reflection">Conclusion and Reflection</a></li>
  <li><a href="#additional-thought-exercise" id="toc-additional-thought-exercise" class="nav-link" data-scroll-target="#additional-thought-exercise">Additional Thought Exercise</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Play with Prolog</h1>
<p class="subtitle lead">An Introduction to Logic Programming and Expert Systems</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Sean Davis, MD, PhD <a href="mailto:seandavi@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Colorado School of Medicine
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 2, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="learning-goals" class="level1">
<h1>Learning Goals:</h1>
<ol type="1">
<li><strong>Understand Expert Systems</strong>: Know what an expert system is, particularly as a narrow AI system.</li>
<li><strong>Explore Logic Programming</strong>: Learn the basic principles of logic programming and how Prolog is used to model complex decision-making processes.</li>
<li><strong>Learn to Implement an Expert System</strong>: Gain hands-on experience using programming to solve problems using logical rules and knowledge representation.</li>
<li><strong>Develop Problem-Solving Skills</strong>: Implement a simple expert system in Prolog, mimicking the decision-making capabilities of a human expert.</li>
<li><strong>Understand limitations of Expert Systems</strong>: Explore the concept of narrow AI and its practical applications in specific domains through the use of expert systems.</li>
</ol>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this exercise, you are going to use the Prolog programming language to build a simple expert system.</p>
<p>An Expert System (ES) is a type of artificial intelligence (AI) system that mimics the decision-making abilities of a human expert in a specific domain or field. It is considered a narrow AI system<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, meaning it’s designed for a specific task or problem, rather than general intelligence. Expert Systems are built using logic programming languages like Prolog, which are well-suited for representing and reasoning with complex knowledge and rules. ESs are designed to reason, solve problems, and make decisions autonomously, just like a human expert would. Expert Systems are built using knowledge representation, inference, and reasoning techniques to capture and apply the expertise of human experts. All that said, Expert Systems often represent a decision tree or a set of rules that are applied to a set of inputs to generate a decision. Think about a phone tree that you might encounter when calling a customer service line or a decision tree that you might use to diagnose a patient.</p>
<p>In this exercise, we will explore the concept of Expert Systems and how they can be implemented. The goal is NOT to become an expert in Expert Systems, but to get a sense of how they <strong>REALLY</strong> work and how they can be used to solve problems. Many expert systems that were built in the 1980s and 1990s were built using Prolog, a logic programming language that is well-suited for representing and reasoning with complex knowledge and rules. Prolog is also fairly readable by humans, so it is a great way to demonstrate a <strong>REAL</strong> expert system. Many of these systems are likely still in use, though they may have been updated to use more modern technologies.</p>
<p>As you work through this exercise, think about how complex an expert system would need to be to be useful in a clinical setting. What are the key components that would need to be included? How would you validate the system to ensure that it is accurate and reliable? What are the limitations of expert systems, and how might they be overcome?</p>
<section id="components-of-an-expert-system" class="level2">
<h2 class="anchored" data-anchor-id="components-of-an-expert-system">Components of an Expert System</h2>
<p>An ES is built around a <strong>knowledge base</strong> that contains a vast amount of information, rules, and relationships specific to the domain it’s designed for. This knowledge is typically acquired from human experts, research papers, or other sources. The knowledge base is organized and structured to facilitate efficient reasoning and problem-solving. Think of this as the “rules” or “facts” that the system uses to make decisions. In a medical setting, gathering the knowledge base might involve reviewing textbooks, guidelines, and expert opinions to extract the key information needed to make diagnoses and treatment recommendations.</p>
<p>The <strong>inference engine</strong> is the “brain” of the ES. It uses the knowledge base to draw conclusions, make decisions, and solve problems. The engine applies logical rules and reasoning techniques to arrive at a solution. <em>Note that the inference engine doesn’t “learn” in the traditional sense, but rather applies predefined rules to the input data.</em> New rules can be added to the system to expand its capabilities, but the system doesn’t learn from experience like a neural network would.</p>
<p>An ES typically has a <strong>user-friendly interface</strong> that allows users to input queries, ask questions, or provide data. The system then uses this input to generate a response, provide recommendations, or solve a problem. The user interface can be text-based, graphical, or voice-activated, depending on the application.</p>
<p>ESs use various <strong>reasoning techniques</strong>, such as forward and backward chaining, to solve problems and make decisions. The reasoning and problem solving capabilities of an ES are what set it apart from traditional software systems. Languages like Prolog are commonly used to implement the logic and reasoning components of an ES.</p>
</section>
<section id="applications-of-expert-systems" class="level2">
<h2 class="anchored" data-anchor-id="applications-of-expert-systems">Applications of Expert Systems</h2>
<p>Expert Systems have been applied in various domains and industries, including healthcare, finance, manufacturing, and customer service. ESs can help diagnose diseases, recommend treatments, and guide patient care. ESs can monitor production processes, detect defects, and recommend quality improvements. ESs can provide customer support, answer frequently asked questions, and route complex issues to human representatives.</p>
</section>
<section id="limitations-of-expert-systems" class="level2">
<h2 class="anchored" data-anchor-id="limitations-of-expert-systems">Limitations of Expert Systems</h2>
<p>While Expert Systems have shown significant promise, they also have some limitations. Building an ES requires a significant amount of knowledge acquisition, which can be time-consuming and costly. The knowledge base must be accurately represented and organized to ensure effective reasoning and problem-solving. ESs require ongoing maintenance to keep their knowledge base up-to-date and ensure they remain effective. ESs may struggle with complex, ambiguous, or uncertain problems that require human intuition or creativity. Because ESs rely on predefined rules and logic, they may not adapt well to new or unexpected situations such as additional symptoms, tests, or rare conditions not accounted for when the system was built.</p>
</section>
<section id="using-chatgpt-or-claude-to-understand-expert-systems" class="level2">
<h2 class="anchored" data-anchor-id="using-chatgpt-or-claude-to-understand-expert-systems">Using ChatGPT (or Claude) to understand Expert Systems</h2>
<p>Before we dive into the actual exercise, ask ChatGPT (or Claude) a few questions to understand the concept of Expert Systems better. Some examples might include:</p>
<ul>
<li>What is an Expert System?</li>
<li>How do Expert Systems work?</li>
<li>What are the components of an Expert System?</li>
<li>What are some applications of Expert Systems?</li>
<li>What are the limitations of Expert Systems?</li>
<li>How are Expert Systems different from traditional software systems?</li>
<li>How do expert systems compare to machine learning systems?</li>
<li>What are some examples of Expert Systems in healthcare?</li>
</ul>
</section>
</section>
<section id="the-prolog-programming-language" class="level1">
<h1>The Prolog Programming Language</h1>
<p>Prolog (short for “Programming in Logic”) is a high-level programming language associated with artificial intelligence (AI) and computational linguistics. It was developed in the early 1970s by Alain Colmerauer and his colleagues at the University of Marseille, with significant contributions from Robert Kowalski at the University of Edinburgh. The language was designed to process natural language and solve logical problems, making it one of the earliest AI-specific programming languages.</p>
<section id="key-features-of-prolog" class="level2">
<h2 class="anchored" data-anchor-id="key-features-of-prolog">Key features of Prolog</h2>
<ul>
<li><p><strong>Declarative Approach</strong>: Prolog focuses on <em>what</em> needs to be solved rather than <em>how</em> to solve it. Think of it like giving a set of rules and facts, and then letting the computer figure out the solution on its own, rather than telling it step-by-step how to get there.</p></li>
<li><p><strong>Logical Reasoning</strong>: Prolog is built on logic. It uses logical thinking to figure things out, much like how we reason through problems in everyday life. For example, if you tell it certain facts like “All humans are mortal” and “Socrates is a human,” Prolog can figure out that “Socrates is mortal.”</p></li>
<li><p><strong>Facts, Rules, and Questions</strong>: Prolog programs are made up of facts (like “Socrates is a human”), rules (like “all humans are mortal”), and questions (like “is Socrates mortal?”). You give Prolog the facts and rules, and then you can ask it questions. It works to find the answers using the information you’ve provided.</p></li>
</ul>
<p>In short, Prolog is like a puzzle solver that uses logic and rules to find solutions, and you don’t have to tell it every step—it figures that part out by itself!</p>
</section>
<section id="role-in-ai" class="level2">
<h2 class="anchored" data-anchor-id="role-in-ai">Role in AI</h2>
<p>Prolog has played a significant role in the history of AI and has been used in various AI applications. Some of the key areas where Prolog has been applied include:</p>
<ul>
<li><strong>Expert Systems</strong>: In the 1980s, Prolog was widely used to develop expert systems, which rely on predefined knowledge and logical rules to provide decision-making capabilities.</li>
<li><strong>Natural Language Processing (NLP)</strong>: Prolog’s strengths in pattern matching and symbolic reasoning made it a good choice for early NLP research and applications, as it could model syntactic and semantic relationships in language.</li>
<li><strong>Automated Theorem Proving</strong>: Due to its foundation in formal logic, Prolog was used in AI systems aimed at proving theorems and solving puzzles.</li>
</ul>
</section>
<section id="historical-significance" class="level2">
<h2 class="anchored" data-anchor-id="historical-significance">Historical Significance</h2>
<p>Prolog played a crucial role in early AI research. It was one of the key languages, alongside LISP, that shaped the development of AI methodologies, particularly in areas such as knowledge representation, reasoning, and machine learning. In the 1980s, Prolog gained popularity when it was adopted by the Japanese Fifth Generation Computer Systems (FGCS) project, which aimed to develop intelligent computers. Although the project did not meet all of its goals, it contributed to Prolog’s international prominence.</p>
</section>
<section id="current-usage" class="level2">
<h2 class="anchored" data-anchor-id="current-usage">Current Usage</h2>
<p>Prolog is not as widely used today as mainstream languages like Python or Java, particularly in AI development. However, it still has a niche role in certain areas of AI, particularly in research and specialized fields like automated reasoning, logic programming, and computational linguistics. Prolog continues to be taught in some academic settings as a tool for understanding logic programming and the fundamentals of AI.</p>
<p>Prolog remains an important historical pillar in AI, particularly for its contributions to logical reasoning, knowledge representation, and expert systems.</p>
</section>
<section id="an-example-prolog-program" class="level2">
<h2 class="anchored" data-anchor-id="an-example-prolog-program">An example Prolog program</h2>
<p>This example illustrates a simple Prolog program that defines facts, rules, and queries. The program is designed to answer the question of whether Socrates is mortal based on the fact that he is human. In practice, Prolog programs can be much more complex, with many facts, rules, and queries that define a domain of interest.</p>
<p>In the code below, everything in a line after a ‘%’ is a comment that explains what the code is doing. Comments are not part of the program itself but are there to help you understand the code.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode prolog code-with-copy"><code class="sourceCode prolog"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Facts</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>human(socrates)<span class="kw">.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">% Rules</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>mortal(<span class="dt">X</span>) <span class="kw">:-</span> human(<span class="dt">X</span>)<span class="kw">.</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">% Queries</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">?-</span> mortal(socrates)<span class="kw">.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="explanation" class="level3">
<h3 class="anchored" data-anchor-id="explanation">Explanation:</h3>
<ol type="1">
<li><p><strong>Facts</strong>:<br>
In Prolog, facts are basic statements about things we know to be true. In this case, the fact <code>human(socrates).</code> means that Socrates is a human. This is a piece of information we’re giving to the program. In a medical context, we might have facts like <code>symptom(fever).</code> or <code>history_of(cancer).</code> that represent information about patients.</p></li>
<li><p><strong>Rules</strong>:<br>
Rules in Prolog define relationships between facts. Here, we have the rule <code>mortal(X) :- human(X).</code>, which means “X is mortal if X is human.” “Variables” in prolog begin with capital letters, so <code>X</code> is a variable. In Prolog, the <code>:-</code> symbol can be read as “if.” So, this rule is saying, “if X is human, then X is mortal.” This is a simple logical relationship that Prolog can use to make inferences.</p></li>
<li><p><strong>Queries</strong>:<br>
When we want to ask Prolog a question (or query), we do so by providing a query. For example, the query <code>?- mortal(socrates).</code> is asking, “Is Socrates mortal?” Prolog will use the facts and rules we’ve provided to answer this question.</p>
<p>In this case, it looks at the rule <code>mortal(X) :- human(X).</code> and sees that since Socrates is a human (from the fact <code>human(socrates).</code>), he must also be mortal. So, Prolog will respond with “Yes” or <code>true</code>.</p></li>
</ol>
</section>
<section id="how-it-works" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works">How It Works:</h3>
<ul>
<li><strong>human(socrates).</strong>: This is a fact we already know—Socrates is human.</li>
<li><strong>mortal(X) :- human(X).</strong>: This is a rule that says any human is mortal.</li>
<li><strong>?- mortal(socrates).</strong>: This is the query we ask, and Prolog checks the facts and rules to conclude that Socrates is mortal because he is human.</li>
</ul>
<p>In summary, this small Prolog program uses logic to infer that Socrates is mortal based on the information that he’s human. It reflects how Prolog works by defining facts, applying rules, and answering queries logically.</p>
</section>
</section>
</section>
<section id="the-task" class="level1">
<h1>The task</h1>
<p>In this exercise, we are going to get a sense of how Prolog works by building a simple expert system. We will create a knowledge base that contains facts and rules about a domain of interest, which will be the clinical question of differentiating:</p>
<ul>
<li><em>flu</em>,</li>
<li><em>common cold</em>,</li>
<li>and <em>allergies</em>.</li>
</ul>
<p>We will then use Prolog to query this knowledge base and draw conclusions based on the rules and relationships defined in the system.</p>
<section id="knowledge-base" class="level2">
<h2 class="anchored" data-anchor-id="knowledge-base">Knowledge Base</h2>
<p>The first step in building an expert system is to define the knowledge base. This knowledge base will contain the facts and rules that the system will use to reason and make decisions. In our case, we are going to build an expert system that can diagnose common conditions like colds, flu, and allergies based on a set of symptoms.</p>
<p>We are going to limit our facts to the following symptoms:</p>
<ul>
<li>runny nose</li>
<li>sneezing</li>
<li>fever</li>
<li>fatigue</li>
</ul>
<p>These are common symptoms that can help differentiate between colds, flu, and allergies. For this exercise, lets assume that the following rules apply:</p>
<ol type="1">
<li>If a patient has a runny nose and sneezing with or without a fever, they likely have a common cold.</li>
<li>If a patient has a fever, sore throat, and runny nose, they likely have the flu.</li>
<li>If a patient has sneezing and a runny nose but no fever, they likely have allergies.</li>
</ol>
<p>We can define these symptoms as <em>facts</em> in Prolog, like this:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Symptom</th>
<th>Prolog Fact Representation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Runny Nose</td>
<td><code>symptom(runny_nose).</code></td>
</tr>
<tr class="even">
<td>Sneezing</td>
<td><code>symptom(sneezing).</code></td>
</tr>
<tr class="odd">
<td>Fever</td>
<td><code>symptom(fever).</code></td>
</tr>
<tr class="even">
<td>Fatigue</td>
<td><code>symptom(fatigue).</code></td>
</tr>
<tr class="odd">
<td>Itchy Eyes</td>
<td><code>symptom(itchy_eyes).</code></td>
</tr>
</tbody>
</table>
<p>We are going to simplify the rules for the sake of this exercise, but in a real-world scenario, the rules would be more complex and based on a larger set of symptoms and diagnostic criteria. In this case, we’ll assume that the presence or absence of these symptoms is enough to differentiate between the conditions.</p>
<p>For the common cold, we’ll use the following rule:</p>
<ul>
<li>If a patient has a runny nose and sneezing but no fever, they likely have a common cold.</li>
<li>Treatment: Rest, drink fluids, consider over-the-counter cold medicine.</li>
</ul>
<p>For the flu, we’ll use the following rule:</p>
<ul>
<li>If a patient has a fever, fatigue, and runny nose, they likely have the flu.</li>
<li>Treatment: Rest, stay hydrated, take anti-fever medication, see a doctor if symptoms worsen.</li>
</ul>
<p>For allergies, we’ll use the following rule:</p>
<ul>
<li>If a patient has sneezing, a runny nose, and itchy eyes, they likely have allergies.</li>
<li>Treatment: Avoid allergens, use antihistamines, consult an allergist if needed.</li>
</ul>
</section>
<section id="visualizing-the-expert-system" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-the-expert-system">Visualizing the Expert System</h2>
<p>Before we dive into the Prolog code, let’s visualize the expert system using a flowchart. This will help us understand the logic and decision-making process that the system will follow. The flowchart will show how the system will diagnose patients based on their symptoms and recommend appropriate treatments.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
    A[Start] --&gt; B{Runny nose?}
    B --&gt;|No| Z[No diagnosis]

    subgraph Symptom_Check
        B --&gt;|Yes| C{Sneezing?}
        C --&gt;|No| Z
        C --&gt;|Yes| D{Fever?}
        D --&gt;|Yes| E[Flu]
        D --&gt;|No| F{Itchy eyes?}
        F --&gt;|Yes| G[Allergies]
        F --&gt;|No| H[Common Cold]
    end

    subgraph Diagnosis
        E --&gt; I[Diagnosis: Flu]
        G --&gt; J[Diagnosis: Allergies]
        H --&gt; K[Diagnosis: Common Cold]
    end

    subgraph Treatment
        I --&gt; L[Treatment: Rest, stay hydrated, take anti-fever medication, see doctor if symptoms worsen]
        J --&gt; M[Treatment: Avoid allergens, use antihistamines, consult allergist if needed]
        K --&gt; N[Treatment: Rest, drink fluids, consider over-the-counter cold medicine]
    end

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="reasoning-engine" class="level2">
<h2 class="anchored" data-anchor-id="reasoning-engine">Reasoning engine</h2>
<p>Once we have defined our knowledge base, we need some kind of “reaoning” or “inference” engine to process the information and draw conclusions. This is where the <a href="https://en.wikipedia.org/wiki/Prolog">Prolog programming language</a> comes in. Prolog is a logic programming language that is well-suited for representing and reasoning with complex knowledge and rules. It uses a declarative syntax that allows you to define relationships, rules, and facts in a concise and intuitive way.</p>
<p>Prolog programs consist of a set of facts and rules that define the relationships between different entities in the system. The Prolog interpreter uses these facts and rules to answer queries and make inferences based on the input data.</p>
<p>Here are some facts that we might include in our Prolog program based on some symptoms that a patient might present with:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode prolog code-with-copy"><code class="sourceCode prolog"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Facts</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>symptom(fever)<span class="kw">.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>symptom(fatigue)<span class="kw">.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>symptom(runny_nose)<span class="kw">.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>symptom(sneezing)<span class="kw">.</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>symptom(itchy_eyes)<span class="kw">.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When we want to use Prolog, we tell the system what we know (facts) and what we want to know (queries). The system then uses the rules and facts to answer our queries.</p>
<p>And here are some rules that we might include in our Prolog program based on the diagnostic criteria for different conditions:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode prolog code-with-copy"><code class="sourceCode prolog"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Rules for diagnossis</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">% Diagnosis rules</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>diagnose(common_cold) <span class="kw">:-</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    symptom(runny_nose)<span class="kw">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    symptom(sneezing)<span class="kw">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">\+</span> symptom(fever)<span class="kw">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write</span>(<span class="st">'</span><span class="er">Diagnosis</span><span class="st">:</span><span class="er"> Common Cold</span><span class="st">'</span>)<span class="kw">,</span> <span class="fu">nl</span><span class="kw">.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>diagnose(flu) <span class="kw">:-</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    symptom(fever)<span class="kw">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    symptom(fatigue)<span class="kw">,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    symptom(runny_nose)<span class="kw">,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write</span>(<span class="st">'</span><span class="er">Diagnosis</span><span class="st">:</span><span class="er"> Flu</span><span class="st">'</span>)<span class="kw">,</span> <span class="fu">nl</span><span class="kw">.</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>diagnose(allergies) <span class="kw">:-</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    symptom(sneezing)<span class="kw">,</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    symptom(runny_nose)<span class="kw">,</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    symptom(itchy_eyes)<span class="kw">,</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write</span>(<span class="st">'</span><span class="er">Diagnosis</span><span class="st">:</span><span class="er"> Allergies</span><span class="st">'</span>)<span class="kw">,</span> <span class="fu">nl</span><span class="kw">.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And we can do the same for the treatment recommendations:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode prolog code-with-copy"><code class="sourceCode prolog"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Rules for treatment</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>treatment(common_cold) <span class="kw">:-</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write</span>(<span class="st">'</span><span class="er">Treatment</span><span class="st">:</span><span class="er"> Rest</span><span class="st">,</span><span class="er"> drink plenty of fluids</span><span class="st">,</span><span class="er"> and consider over</span><span class="st">-</span><span class="er">the</span><span class="st">-</span><span class="er">counter cold medicine</span><span class="st">.'</span>)<span class="kw">,</span> <span class="fu">nl</span><span class="kw">.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>treatment(flu) <span class="kw">:-</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write</span>(<span class="st">'</span><span class="er">Treatment</span><span class="st">:</span><span class="er"> Rest</span><span class="st">,</span><span class="er"> stay hydrated</span><span class="st">,</span><span class="er"> take anti</span><span class="st">-</span><span class="er">fever medication</span><span class="st">,</span><span class="er"> and see a doctor if symptoms worsen</span><span class="st">.'</span>)<span class="kw">,</span> <span class="fu">nl</span><span class="kw">.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>treatment(allergies) <span class="kw">:-</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write</span>(<span class="st">'</span><span class="er">Treatment</span><span class="st">:</span><span class="er"> Avoid allergens</span><span class="st">,</span><span class="er"> use antihistamines</span><span class="st">,</span><span class="er"> and consult an allergist if needed</span><span class="st">.'</span>)<span class="kw">,</span> <span class="fu">nl</span><span class="kw">.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, we can put it all together in a Prolog program that checks the symptoms, makes a diagnosis, and provides treatment recommendations:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode prolog code-with-copy"><code class="sourceCode prolog"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Rule to check diagnosis and apply treatment</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>check_diagnosis_and_treatment <span class="kw">:-</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    diagnose(<span class="dt">Disease</span>)<span class="kw">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    treatment(<span class="dt">Disease</span>)<span class="kw">.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="make-it-real" class="level1">
<h1>Make it REAL</h1>
<p>It turns out that there is an online “Prolog interpreter” that you can use to run Prolog programs in your web browser. I’ve created the prolog program for you, and you can run it by visiting the following link:</p>
<p><a href="https://swish.swi-prolog.org/p/flu_cold_allergies.swinb">Run the Prolog program</a></p>
<p>When you visit the link, you’ll see something like this:</p>
<p><img src="20241002094927.png" class="img-fluid"></p>
<p>You can click the BOTTOM blue button next to the “check_diagnosis_and_treatment” button to execute the program and see the results.</p>
<p><img src="20241002101923.png" class="img-fluid"></p>
<p>If you want to try with different symptoms, you can edit the facts at the top of the program and then click the “check_diagnosis_and_treatment” button to run the program again. Remember that putting a <code>%</code> mark at the beginning of the line turns the line into a comment, so it any line (or symptom) that starts with <code>%</code> will be ignored by the Prolog interpreter. For example, modify the symptoms like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode prolog code-with-copy"><code class="sourceCode prolog"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Facts (Patient's Symptoms)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>symptom(fever)<span class="kw">.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>symptom(fatigue)<span class="kw">.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>symptom(runny_nose)<span class="kw">.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>symptom(sneezing)<span class="kw">.</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">% symptom(itchy_eyes).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then click the “check_diagnosis_and_treatment” button to run the program again.</p>
<p>Note that adding new symptoms <strong>WILL NOT</strong> change the diagnosis or treatment recommendations <strong>UNLESS</strong> you add or modify the rules of the program. Try it by adding a symptom (fact) like <code>symptom(vomiting)</code> and see what happens.</p>
<p>The goal here is not to learn Prolog in depth, but to get a sense of how it works and how it can be used to build expert systems.</p>
</section>
<section id="conclusion-and-reflection" class="level1">
<h1>Conclusion and Reflection</h1>
<ul>
<li><p><strong>Exercise</strong>: How does this Prolog program compare to your own decision-making process for colds, flu, and allergies? Does it capture the key considerations that you would take into account when making a diagnosis and treatment plan? Or would you need to add additional rules and information to make it more accurate and useful?</p></li>
<li><p><strong>Exercise</strong>: Run your own little thought experiment. Imagine you are working in your future specialty. How could an expert system like this one be useful in your clinical practice? What are the potential benefits and limitations of using such a system?</p></li>
</ul>
</section>
<section id="additional-thought-exercise" class="level1">
<h1>Additional Thought Exercise</h1>
<p>Our knowledge base could also be derived from literature. For example, we could use from an article on the diagnosis and management of acute otitis media (ear infection) in children such as the <a href="https://doi.org/10.1542/peds.2012-3488">“Diagnosis and Management of Acute Otitis Media in Children”</a> by Lieberthal et al., published in Pediatrics in 2013.</p>
<ul>
<li>How complex would the expert system based on this article be?</li>
<li>What are some of the key facts that you would want to include (signs, symptoms, patient characteristics, etc.)?</li>
<li>What are some of the key rules that you would want to include (diagnostic criteria, treatment options, follow-up recommendations, etc.)?</li>
<li>How would you validate the system to ensure that it is accurate and reliable?</li>
<li>What are the limitations of such a system, and how might they be overcome?</li>
<li>Why do you think expert systems like this hypothetical system for diagnosing and treating acute otitis media are not more widely used in clinical practice?</li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>See <a href="https://www.datacamp.com/blog/what-is-narrow-ai" class="uri">https://www.datacamp.com/blog/what-is-narrow-ai</a> for more information on narrow AI.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/seandavi\.github\.io\/IDPT-8079\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>